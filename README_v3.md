# かよ皮膚科予約自動化プログラム v3

## 🎯 **概要**

かよ皮膚科のWeb予約システムを自動で操作するPythonプログラムです。
**受付時間の制限に対応**し、患者番号のみの入力で予約を行う仕様です。

## 🔍 **重要な発見**

### ⏰ **受付時間の制限**
- **平日（月〜金）**: 12:00〜16:00（Web予約受付）
- **土曜日**: 12:00まで（Web予約受付）
- **日曜日**: 休診（Web予約受付不可）

### 📱 **予約フロー**
1. メインページで「順番受付(当日外来)」リンクをクリック
2. 患者番号を入力
3. 生年月日を入力
4. 送信ボタンをクリック

**注意**: 受付時間外は予約関連のリンクが表示されません。

## 🚀 **セットアップ**

### 1. 必要なパッケージのインストール
```bash
pip install -r requirements.txt
```

### 2. 設定ファイルの編集
`config_v3.json`を編集して、実際の患者番号を設定してください：

```json
{
  "patient_info": {
    "patient_number": "あなたの患者番号",
    "birth_date": "あなたの生年月日（YYYY-MM-DD形式）"
  }
}
```

## 📖 **使用方法**

### 1. 一度だけ実行（テスト用）
```bash
python hospital_booking_automation_v3.py --once
```

### 2. スケジュール実行（本格運用）
```bash
python hospital_booking_automation_v3.py
```

## ⏰ **スケジュール設定**

デフォルトでは平日12:05に予約処理が実行されます。
`config_v3.json`で時間を変更可能です：

```json
{
  "booking_times": [
    {
      "day": "monday",
      "time": "12:05",
      "enabled": true
    }
  ]
}
```

## 🔧 **設定項目**

### **基本設定**
- `hospital_url`: かよ皮膚科の予約ページURL
- `patient_number`: 患者番号
- `birth_date`: 生年月日（YYYY-MM-DD形式）
- `wait_timeout`: ページ読み込み待機時間（秒）
- `retry_count`: エラー時のリトライ回数

### **ブラウザ設定**
- `headless`: ヘッドレスモード（true/false）
- `user_agent`: ブラウザのUser-Agent

### **ページ要素設定**
- `booking_button`: 予約ボタンのXPath（複数候補）
- `patient_number_input`: 患者番号入力フィールドのXPath
- `birth_date_input`: 生年月日入力フィールドのXPath
- `submit_button`: 送信ボタンのXPath

## 📊 **ログとスクリーンショット**

### **ログファイル**
- `hospital_booking_v3.log`: 実行ログ

### **スクリーンショット**
- `before_booking.png`: 予約前の画面
- `patient_number_form.png`: 患者番号入力画面
- `after_input_complete.png`: 患者番号・生年月日入力完了後
- `after_submit.png`: 送信後
- `error_screenshot_attempt_X.png`: エラー時の画面

## ⚠️ **注意事項**

### **受付時間の制限**
- 受付時間外は予約リンクが表示されません
- 平日12:00〜16:00の間に実行してください
- 土曜日は12:00まで、日曜日は休診

### **患者情報の設定**
- 必ず実際の患者番号を設定してください
- 設定ファイルの`patient_number`を変更してください
- 必ず実際の生年月日を設定してください
- 設定ファイルの`birth_date`を変更してください（YYYY-MM-DD形式）

### **システム要件**
- Python 3.7以上
- Google Chrome
- インターネット接続

## 🐛 **トラブルシューティング**

### **予約リンクが見つからない**
1. 受付時間内かチェック
2. 平日かチェック
3. ページの読み込み完了を確認

### **患者番号入力フィールドが見つからない**
1. 設定ファイルのXPathを確認
2. ページの構造が変更されている可能性

### **送信ボタンが見つからない**
1. 設定ファイルのXPathを確認
2. フォームの送信方法が変更されている可能性

## 📅 **推奨実行タイミング**

### **平日（月〜金）**
- **12:00〜12:30**: 受付開始直後（混雑時）
- **14:00〜15:00**: 午後の受付時間（比較的空いている）

### **土曜日**
- **12:00〜12:30**: 受付開始直後（午前のみ）

### **避けるべき時間**
- 日曜日（休診）
- 受付時間外（12:00前、16:00後）

## 🔄 **バージョン履歴**

### **v3.0**
- 受付時間の制限に対応
- 患者番号のみの入力に対応
- 受付時間チェック機能追加
- スケジュール機能改善

### **v2.0**
- 患者番号のみの入力に対応
- ページ要素の設定ファイル化

### **v1.0**
- 基本的な予約自動化機能
- フォーム入力対応

## 📞 **サポート**

問題が発生した場合は、以下を確認してください：

1. ログファイル（`hospital_booking_v3.log`）
2. スクリーンショット
3. 受付時間内かどうか
4. 設定ファイルの内容

## ⚖️ **免責事項**

このプログラムは教育・研究目的で作成されています。
実際の使用は自己責任で行ってください。
かよ皮膚科の利用規約に従ってご利用ください。
